# Schedule Microservice üìÖ

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –∫–∞–ª–µ–Ω–¥–∞—Ä—è –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —É—á–∏—Ç–µ–ª–µ–π - —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤.

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç RESTful API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π, –≥–¥–µ:
- –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ —Å–æ–∑–¥–∞—é—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø—Ä–µ–¥–º–µ—Ç—É
- –°—Ç—É–¥–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ –ª—é–±—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥–≤–æ–π–Ω–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ó–∞–Ω—è—Ç—ã–µ —Å–ª–æ—Ç—ã –∏—Å—á–µ–∑–∞—é—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- **FastAPI** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Python
- **SQLModel** - —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π ORM –Ω–∞ –æ—Å–Ω–æ–≤–µ SQLAlchemy 2.0
- **PostgreSQL** - –Ω–∞–¥–µ–∂–Ω–∞—è —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Alembic** - —Å–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **Docker** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- **Pytest** - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
```
app/
‚îú‚îÄ‚îÄ api/v1/           # API endpoints
‚îú‚îÄ‚îÄ core/             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ crud/             # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ models/           # SQLModel –º–æ–¥–µ–ª–∏
‚îî‚îÄ‚îÄ schemas/          # Pydantic —Å—Ö–µ–º—ã
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ —Å Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç:**
```bash
git clone <repository>
cd schedule_microservice
```

2. **(–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –û—á–∏—Å—Ç–∏—Ç–µ –ë–î –¥–ª—è —á–∏—Å—Ç–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞:**
```bash
docker-compose down -v
```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:**
```bash
docker-compose up --build
```

- –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
  - –ñ–¥—ë–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ë–î (wait-for-it.sh)
  - –ü—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic
  - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É:**
- API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8000/docs
- Health check: http://localhost:8000/health

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ email (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å uuid) –∏ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å–ª–æ—Ç—ã —Ç–æ–ª—å–∫–æ —Å –±—É–¥—É—â–∏–º –≤—Ä–µ–º–µ–Ω–µ–º.

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. **–°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**
```bash
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# .venv\Scripts\activate  # Windows
```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```bash
pip install -r requirements.txt
```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:**
```bash
# –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL
createdb schedule_db

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head
```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
```bash
uvicorn app.main:app --reload
```

## üìñ API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ (`/api/v1/teachers`)
- `GET /` - —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π
- `POST /` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
- `GET /{id}` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
- `PUT /{id}` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
- `DELETE /{id}` - —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è

### –°—Ç—É–¥–µ–Ω—Ç—ã (`/api/v1/students`)
- `GET /` - —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
- `POST /` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞
- `GET /{id}` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞
- `PUT /{id}` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã (`/api/v1/slots`)
- `GET /available` - –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã
- `POST /` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ—Ç–∞
- `GET /{id}` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ª–æ—Ç–µ
- `PUT /{id}` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª–æ—Ç–∞
- `DELETE /{id}` - —É–¥–∞–ª–µ–Ω–∏–µ —Å–ª–æ—Ç–∞

### –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (`/api/v1/bookings`)
- `POST /` - —Å–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `POST /{id}/confirm` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `POST /{id}/cancel` - –æ—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `GET /stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgresql+asyncpg://user:pass@host:port/db
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=20

# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
APP_NAME=Schedule Microservice
DEBUG=true
API_V1_STR=/api/v1

# CORS
BACKEND_CORS_ORIGINS=["http://localhost:3000"]
```

### Docker Compose

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –≥–æ—Ç–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Docker Compose —Å:
- **PostgreSQL 16** —Å health checks
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–∂–∏–¥–∞–Ω–∏–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ë–î** (wait-for-it.sh)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –º–∏–≥—Ä–∞—Ü–∏–π** –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- **–ì–æ—Ä—è—á–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π** –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **–¢–æ–º–∞–º–∏** –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ race conditions
- **PostgreSQL advisory locks** –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–ª–æ—Ç–æ–≤
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π** –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **Pydantic —Å—Ö–µ–º—ã** –¥–ª—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤** –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
- **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å email** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Checks
```bash
curl http://localhost:8000/health
```

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å:
```json
{
  "status": "healthy",
  "database": "connected", 
  "version": "1.0.0"
}
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏
- –†–∞–∑–ª–∏—á–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
```bash
alembic revision --autogenerate -m "Description"
```

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
- **–í Docker Compose**: –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ.
- **–õ–æ–∫–∞–ª—å–Ω–æ** (–µ—Å–ª–∏ –Ω–µ —á–µ—Ä–µ–∑ Docker):
```bash
alembic upgrade head
```

### –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π
```bash
alembic downgrade -1
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Production –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç:
- ‚úÖ **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è** —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º Dockerfile
- ‚úÖ **Health checks** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ **Graceful shutdown** –æ–±—Ä–∞–±–æ—Ç–∫–∞
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è production
- ‚úÖ **CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏


## ü§ù –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
schedule_microservice/
‚îú‚îÄ‚îÄ app/                    # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ api/v1/            # API –≤–µ—Ä—Å–∏–∏ 1
‚îÇ   ‚îú‚îÄ‚îÄ core/              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ crud/              # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ models/            # –ú–æ–¥–µ–ª–∏ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ schemas/           # Pydantic —Å—Ö–µ–º—ã
‚îú‚îÄ‚îÄ alembic/               # –ú–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ tests/                 # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ docker-compose.yml     # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ requirements.txt       # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

### –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö endpoints:

1. –°–æ–∑–¥–∞–π—Ç–µ –º–æ–¥–µ–ª—å –≤ `app/models/`
2. –î–æ–±–∞–≤—å—Ç–µ —Å—Ö–µ–º—ã –≤ `app/schemas/`
3. –†–µ–∞–ª–∏–∑—É–π—Ç–µ CRUD –≤ `app/crud/`
4. –°–æ–∑–¥–∞–π—Ç–µ router –≤ `app/api/v1/endpoints/`
5. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –≤ `app/api/v1/router.py`
6. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã –≤ `tests/`
